module "postgresql" {
  source                     = "git::https://github.com/camunda/camunda-tf-eks-module//modules/aurora?ref=2.1.0"
  engine_version             = "15.4"
  auto_minor_version_upgrade = false
  cluster_name               = "${var.cluster_name}-postgresql" # change "cluster-name" to your name
  default_database_name      = var.default_database_name

  # Please supply your own secret values
  username           = var.user_name 
  password           = var.secret_password
  vpc_id             = module.eks_cluster.vpc_id
  subnet_ids         = module.eks_cluster.private_subnet_ids
  cidr_blocks        = concat(module.eks_cluster.private_vpc_cidr_blocks, module.eks_cluster.public_vpc_cidr_blocks)
  instance_class     = "db.t3.medium"
  iam_auth_enabled   = true
  ca_cert_identifier = "rds-ca-rsa2048-g1"
  availability_zones = ["eu-west-1a", "eu-west-1b", "eu-west-1c"]

  depends_on = [module.eks_cluster]
}

output "postgres_endpoint" {
  value = module.postgresql.aurora_endpoint
  description = "The Postgres endpoint URL"
}

output "user_name" {
  value = var.user_name
  description = "DB User Name"
}

output "secret_password" {
  value = var.secret_password
  description = "DB User Password"
}
output "default_database_name" {
  value = var.default_database_name
  description = "Database name"
}